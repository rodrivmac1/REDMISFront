<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Perfil</title>
  <link rel="stylesheet" href="css/profile.css">
  <link rel="stylesheet" href="css/sidebar.css">
</head>
<body>
  <div id="sidebar"></div> 
  <div class="title-container">Perfil</div>

  <div class="form-container">
    <div class="form-box">
      <label>Nombre completo</label>
      <input id="nombre" type="text" placeholder="Nombre" disabled>
      <label>Género</label>
      <input id="genero" type="text" placeholder="Género" disabled>
      <label>Universidad</label>
      <input id="universidad" type="text" placeholder="Universidad" disabled>
      <label>Estado</label>
      <input id="estado" type="text" placeholder="Estado" disabled>
    </div>
    <div class="form-box">
      <label>País</label>
      <input id="pais" type="text" placeholder="País" disabled>
      <label>Email</label>
      <input id="email" type="email" placeholder="Email" disabled>
      <label>Contraseña</label>
      <input id="password" type="password" placeholder="Contraseña" disabled>
    </div>
  </div>
  <div class="edit-button-container">
    <button class="edit-button" id="editBtn">Editar</button>
    <button class="edit-button" id="acceptBtn" style="display: none;">Aceptar</button>
    <button class="cancel-Btn" id="cancelBtn" style="display: none;">Cancelar</button>
  </div>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>

  <script src="API/services/members.js" type="module"></script>

  <script>
    // Configuración de prueba: ID y token de autenticación
const testUserId = "1"; // Cambia "123" por el ID que desees probar
const testAuthToken = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6MSwiZW1haWwiOiJhZG1pbkBleGFtcGxlLmNvbSIsInJvbGUiOjEsImV4cCI6MTc0MzAzNjk0OX0.j1L6fD9JVsiFy9WMgPnX15JTIF8jrUYYTMOgKLeNldI";

// Almacenar el ID y el token en localStorage
localStorage.setItem('userId', testUserId);
localStorage.setItem('authToken', testAuthToken);

// Opcional: Mostrar mensaje en la consola para confirmar
console.log('ID y token configurados para pruebas:');
console.log('ID:', testUserId);
console.log('Token:', testAuthToken);
</script>
  <script type="module">
    import membersService from './API/services/members.js';

    const userId = localStorage.getItem('userId');

    const fields = ['nombre', 'genero', 'universidad', 'estado', 'pais', 'email', 'password'];

    const enableFields = (enabled) => {
      fields.forEach(fieldId => {
        document.getElementById(fieldId).disabled = !enabled;
      });
    };

    const toggleButtons = (editing) => {
      document.getElementById('editBtn').style.display = editing ? 'none' : 'inline-block';
      document.getElementById('acceptBtn').style.display = editing ? 'inline-block' : 'none';
      document.getElementById('cancelBtn').style.display = editing ? 'inline-block' : 'none';
    };

    if (userId) {
      membersService.getbyID(userId)
        .then(user => {
          document.getElementById('nombre').value = user.nombre_completo;
          document.getElementById('genero').value = user.genero;
          document.getElementById('universidad').value = user.universidad;
          document.getElementById('estado').value = user.estado;
          document.getElementById('pais').value = user.pais;
          document.getElementById('email').value = user.email;
          document.getElementById('password').value = user.password;
        })
        .catch(error => {
          console.error('Error al cargar el perfil:', error);
          alert('No se pudo cargar la información del usuario.');
        });
    } else {
      alert('Usuario no autenticado.');
    }

    document.getElementById('editBtn').addEventListener('click', () => {
      enableFields(true);
      toggleButtons(true);
    });

    document.getElementById('acceptBtn').addEventListener('click', () => {
      let passwordInput = document.getElementById('password').value;
      let hashedPassword = passwordInput ? CryptoJS.MD5(passwordInput).toString() : "";
      
      
      
      const updatedUser = {
        nombre_completo: document.getElementById('nombre').value,
        genero: document.getElementById('genero').value,
        universidad: document.getElementById('universidad').value,
        estado: document.getElementById('estado').value,
        pais: document.getElementById('pais').value,
        email: document.getElementById('email').value,
        password:hashedPassword
        // Nota: La contraseña no se actualiza aquí directamente por seguridad
      };

      membersService.updateMember(userId, updatedUser)
        .then(() => {
          alert('Perfil actualizado correctamente.');
          enableFields(false);
          toggleButtons(false);
        })
        .catch(error => {
          console.error('Error al actualizar el perfil:', error);
          alert('No se pudo actualizar el perfil.');
        });
    });

    document.getElementById('cancelBtn').addEventListener('click', () => {
      location.reload(); // Recargar la página para restablecer los valores originales
    });
  </script>

<script>
  fetch('sidebar.html')
    .then(res => res.text())
    .then(html => {
      document.getElementById('sidebar').innerHTML = html;
      const path = window.location.pathname.split('/').pop();
      const links = document.querySelectorAll('.sidebar-menu-item');
      links.forEach(link => {
        if (link.getAttribute('href') === path) {
          link.classList.add('active');
        }
      });
    });
</script>
</body>
</html>
