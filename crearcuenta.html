<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crear Cuenta</title>
    <link rel="stylesheet" href="css/crearcuenta.css">
    <!-- Incluimos la librería CryptoJS para MD5 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
</head>
<body>

    <div class="background"></div>

    <div class="form-container">
        <h2 class="title">¡Bienvenido!</h2>
        <p class="subtitle">Ingresa la siguiente información para crear una nueva cuenta</p>

        <form id="register-form">
            <!-- Nombre -->
            <label for="nombre">Nombre</label>
            <input type="text" id="nombre" name="nombre" class="input-field" placeholder="Ej. José Rómulo" required>
            <small id="nombre-error" class="error-message">El nombre es obligatorio</small>

            <!-- Apellidos -->
            <label for="apellidos">Apellidos</label>
            <input type="text" id="apellidos" name="apellidos" class="input-field" placeholder="Ej. Sosa Ortiz" required>
            <small id="apellidos-error" class="error-message">Los apellidos son obligatorios</small>

            <!-- Género -->
            <label for="genero">Género</label>
            <select id="genero" name="genero" class="input-field" required>
                <option value="" disabled selected>Selecciona tu género</option>
                <option value="Masculino">Masculino</option>
                <option value="Femenino">Femenino</option>
                <option value="Otro">Otro</option>
            </select>
            <small id="genero-error" class="error-message">Selecciona un género</small>

            <!-- Correo Electrónico -->
            <label for="email">Correo Electrónico</label>
            <input type="email" id="email" name="email" class="input-field" placeholder="Ej. josejose@mail.com" required>
            <small id="email-error" class="error-message">Correo inválido</small>

            <!-- Contraseña -->
            <label for="password">Contraseña</label>
            <input type="password" id="password" name="password" class="input-field" placeholder="••••••••" required>
            <small id="password-error" class="error-message">La contraseña debe tener al menos 8 caracteres</small>

            <button type="submit" class="button">Crear Cuenta</button>
        </form>

        <p class="login-link">
            ¿Ya tienes una cuenta? <a href="#">Iniciar sesión</a>
        </p>
    </div>

    <script type="module">
        import membersService from './API/services/members.js';

        // Función para hashear la contraseña usando MD5
        function hashPasswordMD5(password) {
            return CryptoJS.MD5(password).toString();
        }

        document.getElementById("register-form").addEventListener("submit", async function(event) {
            event.preventDefault();
            
            const nombreField = document.getElementById("nombre");
            const apellidosField = document.getElementById("apellidos");
            const generoField = document.getElementById("genero");
            const emailField = document.getElementById("email");
            const passwordField = document.getElementById("password");

            // Validación básica
            if (!nombreField.value.trim() || !apellidosField.value.trim() || !generoField.value || 
                !emailField.value.trim() || !passwordField.value || passwordField.value.length < 8) {
                alert("Por favor completa todos los campos correctamente");
                return;
            }

            try {
                // Hashear la contraseña con MD5 antes de enviarla
                const hashedPassword = hashPasswordMD5(passwordField.value);
                
                // Crear objeto con los datos del miembro
                const memberData = {
                    nombre: nombreField.value.trim(),
                    apellidos: apellidosField.value.trim(),
                    genero: generoField.value,
                    email: emailField.value.trim(),
                    password: hashedPassword  // Enviamos la contraseña hasheada con MD5
                };

                // Enviar datos al servidor
                const response = await membersService.addMember(memberData);
                
                // Mostrar mensaje de éxito
                alert('Cuenta creada exitosamente!');
                
                // Limpiar el formulario
                this.reset();
                
            } catch (error) {
                console.error('Error al crear la cuenta:', error);
                alert('Ocurrió un error al crear la cuenta. Por favor intenta nuevamente.');
            }
        });
    </script>

</body>
</html>